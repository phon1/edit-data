from flask import Flask, render_template, request, redirect, url_for
from sqlalchemy import create_engine, text
import random

app = Flask(__name__)

# Kết nối cơ sở dữ liệu PostgreSQL
engine = create_engine(
    "postgresql://kami:123@192.168.1.200:5432/phongdev"
)

# Hàm lấy ngẫu nhiên một mẫu từ bảng instruction_dataset
def get_random_sample():
    query = text("SELECT * FROM instruction_dataset TABLESAMPLE BERNOULLI(1) LIMIT 1;")
    with engine.connect() as conn:
        result = conn.execute(query)
        return result.fetchone()

# Hàm cập nhật dữ liệu vào cơ sở dữ liệu
def update_sample_data(sample_id, instruction_vi, input_vi, output_vi):
    with engine.connect() as conn:
        query = text("UPDATE instruction_dataset SET instruction_vi=:insv, input_vi=:inpv, output_vi=:outv WHERE id=:id;")
        conn.execute(query, insv=instruction_vi, inpv=input_vi, outv=output_vi, id=sample_id)

# Biến lưu trữ trạng thái đăng nhập, ban đầu là False (chưa đăng nhập)
logged_in = False
phone_number = ""  # Biến lưu trữ số điện thoại người dùng đã đăng nhập

@app.route("/", methods=["GET", "POST"])
def index():
    global logged_in, phone_number
    # Kiểm tra trạng thái đăng nhập, nếu chưa đăng nhập, chuyển hướng đến trang login
    if not logged_in:
        return redirect(url_for('login'))

    if request.method == "POST":
        # Xử lý nút "Save" và các thao tác liên quan đến index.html
        instruction_vi = request.form["instruction_vi"]
        input_vi = request.form["input_vi"]
        output_vi = request.form["output_vi"]
        sample_id = int(request.form["id"])

        # Thực hiện câu truy vấn cập nhật vào cơ sở dữ liệu
        update_sample_data(sample_id, instruction_vi, input_vi, output_vi)

    # Lấy một mẫu ngẫu nhiên từ cơ sở dữ liệu
    sample = get_random_sample()

    # Render template và truyền dữ liệu để hiển thị trên giao diện web
    return render_template("index.html", sample=sample, logged_in=logged_in, phone_number=phone_number)

@app.route("/login", methods=["GET", "POST"])
def login():
    global logged_in, phone_number
    # Kiểm tra trạng thái đăng nhập, nếu đã đăng nhập, chuyển hướng đến trang index
    if logged_in:
        return redirect(url_for('index'))

    if request.method == "POST":
        # Xử lý đăng nhập ở đây
        # Kiểm tra thông tin đăng nhập từ form
        # Nếu thông tin đúng, đặt logged_in thành True và chuyển hướng đến trang index
        # Nếu thông tin sai, hiển thị thông báo lỗi

        # Ví dụ đơn giản: Mã đăng nhập thành công cho mọi giá trị nhập vào
        logged_in = True
        phone_number = request.form["phoneNumber"]
        return redirect(url_for('index'))

    return render_template("login.html")

@app.route("/logout")
def logout():
    global logged_in, phone_number
    # Xử lý đăng xuất ở đây
    # Đặt logged_in về False và xoá thông tin người dùng
    logged_in = False
    phone_number = ""
    return redirect(url_for('login'))

if __name__ == "__main__":
    app.run(debug=True)

app.py

<!DOCTYPE html>
<html>
<head>
    <title>Random Sample Data</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header>
        <div class="user-info">
            {% if logged_in %}
                <p>Hello user, {{ phone_number }}</p>
                <div class="logout-btn">
                    <a href="{{ url_for('logout') }}">Log out</a>
                </div>
            {% endif %}
        </div>
    </header>
    <h1>Random Sample Data</h1>
    <form method="post" action="/">
        <div class="container">
            <div class="main-column">
                <div class="label-row">
                    <div class="label-left">
                        <label for="id">ID:</label>
                        <input type="text" id="id" name="id" value="{{ sample.id }}" readonly>
                    </div>
                    <div class="label-right">
                        <label for="message_id">Message ID:</label>
                        <input type="text" id="message_id" name="message_id" value="{{ sample.message_id }}" readonly>
                    </div>
                    <div class="label-right">
                        <label for="status">Status:</label>
                        <input type="text" id="status" name="status" value="{{ sample.status }}" readonly>
                    </div>
                </div>
                
                <div class="label-row">
                    <div class="label-left">
                        <label for="instruction">Instruction:</label>
                        <textarea type="text" id="instruction" name="instruction" readonly>{{ sample.instruction }}</textarea>
                    </div>
                    <div class="label-right">
                        <label for="instruction_vi">Instruction (Vietnamese):</label>
                        <textarea type="text" id="instruction_vi" name="instruction_vi">{{ sample.instruction_vi }}</textarea>
                    </div>
                </div>

                <div class="label-row">
                    <div class="label-left">
                        <label for="input">Input:</label>
                        <textarea id="input" name="input" rows="4" readonly>{{ sample.input }}</textarea>
                    </div>
                    <div class="label-right">
                        <label for="input_vi">Input (Vietnamese):</label>
                        <textarea id="input_vi" name="input_vi" rows="4">{{ sample.input_vi }}</textarea>
                    </div>
                </div>
                
                <div class="label-row">
                    <div class="label-left">
                        <label for="output">Output:</label>
                        <textarea id="output" name="output" rows="4" readonly>{{ sample.output }}</textarea>
                    </div>
                    <div class="label-right">
                        <label for="output_vi">Output (Vietnamese):</label>
                        <textarea id="output_vi" name="output_vi" rows="4">{{ sample.output_vi }}</textarea>
                    </div>
                </div>
            </div>
        </div>
        <input type="submit" value="Save">
    </form>
</body>
</html>
index.html

login.html
<!DOCTYPE html>
<html>
<head>
    <title>Login Page</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='login.css') }}">  <!-- Thêm dòng này để liên kết đến file CSS -->
</head>
<body>
    <div class="login-form">
        <h1>Login Page</h1>
        <form method="POST">
            <label for="phoneNumber">Phone Number:</label>
            <input type="text" id="phoneNumber" name="phoneNumber">
            <br>
            {% if error %}
                <span class="error">{{ error }}</span>
                <br>
            {% endif %}
            <button type="submit">Login</button>
        </form>
    </div>
</body>
</html>

/* Global styles */
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
}

header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #007BFF;
    color: white;
    padding: 10px;
}
.logout-button{
    cursor: pointer;
    background-color: #DC3545; /* Red color for logout button */

}

h1 {
    font-size: 24px;
    margin: 0;
    padding: 0;
}

.user-info {
    display: flex;
    align-items: center;
}

.user-info p {
    margin: 0;
    margin-right: 10px; /* Add margin between "hello user" and phone number */
}

.user-info a {
    background-color: #004080;
    color: #fff;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    text-decoration: none;
    margin-left: auto; /* Move "logout" to the rightmost position */
}

.user-info a:hover {
    background-color: #0056b3;
}

.user-info a:focus {
    outline: none;
}

.user-info a:active {
    background-color: #003366;
}

/* Left and Right column styles */
.main-column {
    flex: 1;
    margin-bottom: 20px;
}

.label-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
}

.label-left {
    flex: 1;
    color: #007BFF;
    font-weight: bold;
}

.label-right {
    flex: 1;
    color: #007BFF;
    font-weight: bold;
    margin-left: 20px;
}

/* Input and textarea styles */
textarea,
input[type="text"] {
    width: 100%;
    padding: 5px;
    margin-top: 10px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    overflow-wrap: break-word;
}

textarea[readonly],
input[type="text"][readonly] {
    background-color: #f2f2f2;
    border-color: #f2f2f2;
    color: #000;
    cursor: default;
}

textarea:focus,
input[type="text"]:focus {
    border-color: #007BFF;
    box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
}

/* Output box styles */
#output,
#output_vi {
    max-height: 400px;
    overflow-y: auto;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-top: 10px;
    margin-bottom: 10px;
    overflow-wrap: break-word;
}

/* Save button styles */
input[type="submit"] {
    background-color: #007BFF;
    color: #fff;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s;
}

input[type="submit"]:hover {
    background-color: #0056b3;
}

input[type="submit"]:focus {
    outline: none;
}

input[type="submit"]:active {
    background-color: #004080;
}

/* Additional styles */
/* Add padding between the main content and label row */
.label-row {
    padding: 10px;
}

/* Add margin between the main columns */
.main-column {
    margin-right: 20px;
}

/* Make textarea fixed by disabling resizing */
textarea {
    resize: none;
}
style.css

body {
    font-family: Arial, sans-serif;
    background-image: url('https://cdn.pixabay.com/photo/2016/04/18/22/05/seashells-1337565_640.jpg'); /* Thay đổi đường dẫn đến ảnh nền */
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

.login-form {
    background-color: rgba(255, 255, 255, 0.8); /* Thay đổi màu nền và độ mờ theo ý muốn */
    padding: 20px;
    border-radius: 10px;
    max-width: 400px;
    width: 100%;
}

.error {
    color: red;
}

label, input {
    display: block;
    margin: 10px;
}

button {
    margin-top: 20px;
}

login.css
đọc lai phần code và code lại sao cho button logout nằm sát về lề trái và có tính thẩm mỹ cao (đẹp)